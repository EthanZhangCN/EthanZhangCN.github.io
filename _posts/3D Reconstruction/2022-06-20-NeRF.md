---
layout: post
title: NeRF中体素渲染方程推导
subtitle: 
gh-repo: daattali/beautiful-jekyll
gh-badge: [star, fork, follow]
tags: [Algorithm]
comments: true
---
## 光线模型
[Optical Models for Direct Volume Rendering](https://courses.cs.duke.edu/spring03/cps296.8/papers/max95opticalModelsForDirectVolumeRendering.pdf)


### 1 光线纯吸收模型
假设一个截面积为$E$ 厚度为$\Delta_s$的圆柱体介质，由N个大小均等半径为$r$的小球颗粒组成，小球颗粒投影面积$A=\pi r^2$，单位体积的颗粒数量为$\rho$，则有$NA = \rho AE \Delta_s$，假设所有的光线打到小球颗粒上都被吸收没有反射与折射，光线在圆柱截面单位面积阻挡率为（不透明度）$\frac{NA}{E}= \rho A \Delta_s$。

<div align=center >
<img src="https://github.com/EthanZhangCN/EthanZhangCN.github.io/blob/main/_posts/3D Reconstruction/imgs/1.png?raw=true" width=200 height=200  />
</div>

当$\Delta_s$无限小时，可以认为小球颗粒没有重叠，沿圆柱厚度s积分，就可以得到微分方程 ,为了区分其它模型此处光强用$I_u$表示, 光通过截面$ds$被吸收量：

$$\frac{dI_u}{ds}=-\rho(s)AI_u(s)=- \tau(s)I_u(s) ----（1）$$

微分方程含义：光线穿过厚度为$ds$截面,穿过该截面后的剩余光强$dI_u$，穿过该截面前的照射光强$I_u(s)$，颗粒在该截面的投影面积$\rho(s)A$, 



解以上微分方程（1），具体参考“一阶线性非齐次微分方程”，可以得到：

$$I_u(s) = I_{u0} e^{(-\int_0^s{\tau(t)dt})}----(2)$$

方程（2）表明光线穿透介质厚度为$s$时的光强度，当$s$为$0$时, 即未被介质吸收, 光强为初始光强$I_{u0}$

### 2 光线纯发射模型
假设上述模型中的小球完全透明，不吸收光，但是可以反射光。单位投影面积上发光强度为$C$，则圆柱体截面总发光强度为$NCA = \rho CAE \Delta_s$，圆柱截面单位面积发光强度为$\frac{NCA}{E}= \rho CA \Delta_s$。当$\Delta_s$无限小时，可以得到微分方程，光强用$I_v$表示：

$$\frac{dI_v}{ds}=\rho(s)AC(s)=C(s) \tau(s)  =g(s)----（3）$$

微分方程含义：在厚度为$ds$的截面上的发光量为$dI_v$, 该截面上发光颗粒的面积$\rho(s)A$，单位颗粒面积发光强度$C(s)$
解以上微分方程(3)可以得到：

$$I_v(s) = I_{v0} +\int_0^s{g(t)dt}----(4)$$

### 3 吸收发射联合模型
综合（1）（3）得到联合模型微分方程：

$$\frac{dI}{ds}=\frac{d(I_u + I_v)}{ds}=g(s)- \tau(s)I_u(s)=g(s)- \tau(s)I(s)----（5）$$

微分方程含义：考虑吸收和漫反射，强度为$I$的光线在穿透介质厚度为$ds$的截面后的光强为$dI$






